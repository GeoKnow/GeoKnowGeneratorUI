<h3 class="green bold" data-i18n="_named-graphs-management_"></h3>

<div ng-controller="GraphCtrl">

  <button type="button" class="btn btn-primary btn-large" data-toggle="modal" data-target="#modalGraph" ng-click="new();" data-i18n="_add-dataset_"></button>

  <div class="modal fade" id="modalGraph">
  <div class="modal-dialog">
  <div class="modal-content">
    <form name="graphForm" class="form-horizontal InputForm" role="form" novalidate>
      <div class="modal-header">
        <button type="button" class="close" ng-click="close('#modalGraph')" aria-hidden="true">&times;</button>
        <h5 class="modal-title green bold" data-i18n="{{modaltitle}}"></h5>
      </div>

      <div class="modal-body">
         <div class="form-group">
          <label class="col-lg-2 control-label" data-i18n="_name_"></label>
          <div class="col-lg-10">
            <input type="text" class="form-control" id="name" name="name" data-i18n-attr="_name_|placeholder" ng-model="namedgraph.name" ng-disabled="!isNew()" required regex-validate="identifier" unique-identifier/>
            <div class="error"  ng-show="graphForm.name.$dirty && graphForm.name.$invalid">{{'_invalid-field-message_' | i18n}}:
              <span ng-show="graphForm.name.$error.required || graphForm.name.$error.regexValidate" data-i18n="_malformed-letters-number-id-message_"></span>
              <span ng-show="graphForm.name.$error.uniqueIdentifier" data-i18n="_id-already-exists-message_"></span>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="name" class="col-lg-2 control-label" data-i18n="_label_"></label>
          <div class="col-lg-10">
            <input type="text" class="form-control" id="label" name="label" data-i18n-attr="_label_|placeholder" ng-model="namedgraph.graph.label" required />
            <div class="error"  ng-show="graphForm.label.$dirty && graphForm.label.$invalid">{{'_invalid-field-message_' | i18n}}:
              <span ng-show="graphForm.label.$error.required" data-i18n="_label-missed-message_"></span>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="description" class="col-lg-2 control-label" data-i18n="_description_"></label>
          <div class="col-lg-10">
            <input type="text" class="form-control" name="description" id="description" data-i18n-attr="_description_|placeholder" ng-model="namedgraph.graph.description" required />
            <div class="error"  ng-show="graphForm.description.$dirty && graphForm.description.$invalid">{{'_invalid-field-message_' | i18n}}:
              <span ng-show="graphForm.description.$error.required" data-i18n="_description-missed-message_"></span>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label class="col-lg-2 control-label" data-i18n="_created_"></label>
          <div class="col-lg-10">
            <p class="form-control-static">{{namedgraph.graph.created}}</p>
          </div>
        </div>
        <div class="form-group">
          <label class="col-lg-2 control-label" data-i18n="_modified_"></label>
          <div class="col-lg-10">
            <p class="form-control-static">{{namedgraph.graph.modified}}</p>
          </div>
        </div>
        <div class="form-group" ng-if="namedgraph.owner != null">
          <label class="col-lg-2 control-label" data-i18n="_owner_"></label>
          <div class="col-lg-10">
              <p class="form-control-static">{{namedgraph.owner}}</p>
          </div>
        </div>
        <div class="form-group">
          <label class="col-lg-2 control-label" data-i18n="_sparql-endpoint_"></label>
          <div class="col-lg-10">
            <p class="form-control-static">{{namedgraph.graph.endpoint}}</p>
          </div>
        </div>
          <div class="form-group" ng-if="isUserAuthenticated()">
              <label class="col-lg-2 control-label" data-i18n="_access_"></label>
              <div class="col-lg-10">
                  <select id="access" class="form-control" ng-model="namedgraph.publicAccess" ng-options="uri as localize(title) for (uri, title) in accessModes"></select>
              </div>
          </div>
          <div class="row" ng-if="isUserAuthenticated()">
              <label class="col-xs-2 text-left" data-i18n="_user-access_"></label>
              <div class="col-xs-10">
                  <table class="table table-striped">
                      <tr>
                          <th data-i18n="_user_"></th>
                          <th data-i18n="_read_"></th>
                          <th data-i18n="_write_"></th>
                      </tr>
                      <tr ng-repeat="user in users | filter:userFilter">
                          <td>{{user}}</td>
                          <td><input type="checkbox" ng-checked="namedgraph.usersRead.indexOf(user) > -1" ng-click="toggleUserRead(user)"/></td>
                          <td><input type="checkbox" ng-checked="namedgraph.usersWrite.indexOf(user) > -1" ng-click="toggleUserWrite(user)"/></td>
                      </tr>
                  </table>
              </div>
          </div>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn-sm btn-primary" ng-click="save();" ng-disabled="graphForm.$invalid || isUnchanged(namedgraph)" data-i18n="_save_"></button>
        <button type="button" class="btn-sm btn-default" ng-click="close('#modalGraph')" data-i18n="_cancel_"></button>
      </div>      
    </form>
 	</div>
 	</div>
 	</div>

  <h4 data-i18n="_user-graphs_"></h4>

  <table class="table table-striped">
  <thead>
    <tr>
      <th data-i18n="_action_"></th>
      <th>URI</th>
      <th data-i18n="_label_"></th>
      <th data-i18n="_description_"></th>
      <th data-i18n="_created_"></th>
      <th data-i18n="_modified_"></th>
      <th ng-if="isUserAuthenticated()" data-i18n="_public-access_"></th>
      <th ng-if="isUserAuthenticated()" data-i18n="_read-access_"></th>
      <th ng-if="isUserAuthenticated()" data-i18n="_write-access_"></th>
    </tr>
  </thead>
  <tbody>
     <tr ng-repeat="namedgraph in namedgraphs">
      <td>
        <button type="button" class="btn btn-default btn-xs" ng-click="delete('{{namedgraph.name}}')"><span class="glyphicon glyphicon-trash"></span></button>
        <button type="button" class="btn btn-default btn-xs" data-toggle="modal" data-target="#modalGraph" ng-click="edit('{{namedgraph.name}}');"><span class="glyphicon glyphicon-edit"></span></button>
      </td>
      <td>{{namedgraph.name}}</td>
      <td>{{namedgraph.graph.label}}</td>
      <td>{{namedgraph.graph.description}}</td>
      <td>{{namedgraph.graph.created}}</td>
      <td>{{namedgraph.graph.modified}}</td>
      <td ng-if="isUserAuthenticated()">{{accessModes[namedgraph.publicAccess]}}</td>
      <td ng-if="isUserAuthenticated()">
          <ul class="list-unstyled">
              <li ng-repeat="user in namedgraph.usersRead">{{user}}</li>
          </ul>
      </td>
      <td ng-if="isUserAuthenticated()">
          <ul class="list-unstyled">
              <li ng-repeat="user in namedgraph.usersWrite">{{user}}</li>
          </ul>
      </td>
    </tr>
  </tbody>
  </table>

    <br/>

  <div ng-if="!isAdminLogged()">
    <h4>
        <span class="btn-group">
            <button type="button" class="btn btn-link reset" ng-click="refreshAccessibleGraphs()">
                <i class="glyphicon glyphicon-refresh" aria-hidden="true"></i>
            </button>
        </span>
        {{'_accessible-graphs_' | i18n}}
    </h4>
    <table class="table table-striped">
        <thead>
        <tr>
            <th>URI</th>
            <th data-i18n="_label_"></th>
            <th data-i18n="_description_"></th>
            <th data-i18n="_created_"></th>
            <th data-i18n="_modified_"></th>
            <th data-i18n="_access_"></th>
        </tr>
        </thead>
        <tbody>
        <tr ng-repeat="namedgraph in accnamedgraphs">
            <td>{{namedgraph.name}}</td>
            <td>{{namedgraph.graph.label}}</td>
            <td>{{namedgraph.graph.description}}</td>
            <td>{{namedgraph.graph.created}}</td>
            <td>{{namedgraph.graph.modified}}</td>
            <td>{{namedgraph.access}}</td>
        </tr>
        </tbody>
    </table>
  </div>

    <div ng-if="isAdminLogged()">
    <h4>
        <span class="btn-group">
            <button type="button" class="btn btn-link reset" ng-click="refreshAllGraphs()">
                <i class="glyphicon glyphicon-refresh" aria-hidden="true"></i>
            </button>
        </span>
        {{'_all-graphs_' | i18n}}
    </h4>
    <table class="table table-striped">
        <thead>
        <tr>
            <th data-i18n="_action_"></th>
            <th>URI</th>
            <th data-i18n="_label_"></th>
            <th data-i18n="_description_"></th>
            <th data-i18n="_created_"></th>
            <th data-i18n="_modified_"></th>
            <th data-i18n="_owner_"></th>
            <th data-i18n="_public-access_"></th>
            <th data-i18n="_read-access_"></th>
            <th data-i18n="_write-access_"></th>
        </tr>
        </thead>
        <tbody>
        <tr ng-repeat="namedgraph in allgraphs | filter:graphFilter">
            <td>
                <button type="button" class="btn btn-default btn-xs" ng-click="deleteForeign('{{namedgraph.name}}')"><span class="glyphicon glyphicon-trash"></span></button>
                <button type="button" class="btn btn-default btn-xs" data-toggle="modal" data-target="#modalGraph" ng-click="editAdmin('{{namedgraph.name}}');"><span class="glyphicon glyphicon-edit"></span></button>
            </td>
            <td>{{namedgraph.name}}</td>
            <td>{{namedgraph.graph.label}}</td>
            <td>{{namedgraph.graph.description}}</td>
            <td>{{namedgraph.graph.created}}</td>
            <td>{{namedgraph.graph.modified}}</td>
            <td>{{namedgraph.owner}}</td>
            <td>{{accessModes[namedgraph.publicAccess]}}</td>
            <td>
                <ul class="list-unstyled">
                    <li ng-repeat="user in namedgraph.usersRead">{{user}}</li>
                </ul>
            </td>
            <td>
                <ul class="list-unstyled">
                    <li ng-repeat="user in namedgraph.usersWrite">{{user}}</li>
                </ul>
            </td>
        </tr>
        </tbody>
    </table>
    </div>

  <br/>

  <button type="button" class="btn btn-primary btn-large" data-toggle="modal" data-target="#modalGroup" ng-click="newGroup();" data-i18n="_add-graph-group_"></button>

  <div class="modal fade" id="modalGroup">
  <div class="modal-dialog">
  <div class="modal-content">
      <form name="groupForm" class="form-horizontal InputForm" role="form" novalidate>
          <div class="modal-header">
              <button type="button" class="close" ng-click="close('#modalGroup')" aria-hidden="true">&times;</button>
              <h5 class="modal-title green bold" data-i18n="{{modaltitle}}"></h5>
          </div>

          <div class="modal-body">
              <div class="form-group">
                  <label class="col-lg-2 control-label" data-i18n="_name_"></label>
                  <div class="col-lg-10">
                      <input type="text" class="form-control" id="name" name="name" data-i18n-attr="_name_|placeholder" ng-model="graphgroup.name" ng-disabled="!isNewGroup()" required regex-validate="identifier" unique-identifier/>
                      <div class="error"  ng-show="groupForm.name.$dirty && groupForm.name.$invalid">{{'_invalid-field-message_' | i18n}}:
                          <span ng-show="groupForm.name.$error.required || groupForm.name.$error.regexValidate" data-i18n="_malformed-letters-number-id-message_"></span>
                          <span ng-show="groupForm.name.$error.uniqueIdentifier" data-i18n="_id-already-exists-message_"></span>
                      </div>
                  </div>
              </div>
              <div class="form-group">
                  <label for="name" class="col-lg-2 control-label" data-i18n="_label_"></label>
                  <div class="col-lg-10">
                      <input type="text" class="form-control" id="label" name="label" data-i18n-attr="_label_|placeholder" ng-model="graphgroup.label" required />
                      <div class="error"  ng-show="groupForm.label.$dirty && groupForm.label.$invalid">{{'_invalid-field-message_' | i18n}}:
                          <span ng-show="groupForm.label.$error.required" data-i18n="_label-missed-message_"></span>
                      </div>
                  </div>
              </div>
              <div class="form-group">
                  <label for="description" class="col-lg-2 control-label" data-i18n="_description_"></label>
                  <div class="col-lg-10">
                      <input type="text" class="form-control" name="description" id="description" data-i18n-attr="_description_|placeholder" ng-model="graphgroup.description" required />
                      <div class="error"  ng-show="groupForm.description.$dirty && groupForm.description.$invalid">{{'_invalid-field-message_' | i18n}}:
                          <span ng-show="groupForm.description.$error.required" data-i18n="_description-missed-message_"></span>
                      </div>
                  </div>
              </div>
              <div class="form-group">
                  <label class="col-lg-2 control-label" data-i18n="_created_"></label>
                  <div class="col-lg-10">
                      <p class="form-control-static">{{graphgroup.created}}</p>
                  </div>
              </div>
              <div class="form-group">
                  <label class="col-lg-2 control-label" data-i18n="_modified_"></label>
                  <div class="col-lg-10">
                      <p class="form-control-static">{{graphgroup.modified}}</p>
                  </div>
              </div>
              <div class="row">
                  <label class="col-xs-2 text-left" data-i18n="_graphs_"></label>
                  <div class="col-xs-10">
                      <div ng-repeat="graph in allgraphs">
                          <input type="checkbox" ng-checked="graphgroup.namedGraphs.indexOf(graph.name) > -1" ng-click="toggleGraph(graph.name)"/>{{graph.name}}
                      </div>
                  </div>
              </div>
          </div>
          <div class="modal-footer">
              <button type="submit" class="btn-sm btn-primary" ng-click="saveGroup();" ng-disabled="groupForm.$invalid || isUnchanged(graphgroup)" data-i18n="_save_"></button>
              <button type="button" class="btn-sm btn-default" ng-click="close('#modalGroup')" data-i18n="_cancel_"></button>
          </div>
      </form>
  </div>
  </div>
  </div>

  <h4>
      <span class="btn-group">
          <button type="button" class="btn btn-link reset" ng-click="refreshGraphGroups()">
              <i class="glyphicon glyphicon-refresh" aria-hidden="true"></i>
          </button>
      </span>
      {{'_graph-groups_' | i18n}}
  </h4>

  <table class="table table-striped">
      <thead>
      <tr>
          <th data-i18n="_action_"></th>
          <th>URI</th>
          <th data-i18n="_label_"></th>
          <th data-i18n="_description_"></th>
          <th data-i18n="_created_"></th>
          <th data-i18n="_modified_"></th>
          <th data-i18n="_graphs_"></th>
      </tr>
      </thead>
      <tbody>
      <tr ng-repeat="gg in graphgroups">
          <td>
              <button type="button" class="btn btn-default btn-xs" ng-click="deleteGroup('{{gg.name}}')"><span class="glyphicon glyphicon-trash"></span></button>
              <button type="button" class="btn btn-default btn-xs" data-toggle="modal" data-target="#modalGroup" ng-click="editGroup('{{gg.name}}');"><span class="glyphicon glyphicon-edit"></span></button>
          </td>
          <td>{{gg.name}}</td>
          <td>{{gg.label}}</td>
          <td>{{gg.description}}</td>
          <td>{{gg.created}}</td>
          <td>{{gg.modified}}</td>
          <td>
              <ul class="list-unstyled">
                  <li ng-repeat="graph in gg.namedGraphs">{{graph}}</li>
              </ul>
          </td>
      </tr>
      </tbody>
  </table>
</div> <!-- controller div -->